<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>í›ˆìˆ˜ AI Agent (MVP)</title>

  <style>
    :root { --border:#e5e7eb; --bg:#fafafa; --text:#111827; --muted:#6b7280; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Noto Sans KR, sans-serif; color:var(--text); background:#fff; }

    header {
      padding:12px 16px;
      border-bottom:1px solid var(--border);
      display:flex;
      gap:12px;
      align-items:center;
    }
    header h1 { font-size:16px; margin:0; }
    header .small { color:var(--muted); font-size:12px; }
    .grow { flex:1; }

    .wrap {
      height: calc(100vh - 54px);
      display:grid;
      grid-template-columns: 1.2fr 0.8fr;
    }

    /* LEFT */
    .left {
      border-right:1px solid var(--border);
      display:flex;
      flex-direction:column;
      min-height:0;
    }

    .toolbar {
      padding:10px 12px;
      display:flex;
      gap:8px;
      align-items:center;
      border-bottom:1px solid var(--border);
      background:var(--bg);
      flex-wrap:wrap;
    }

    button, input { font: inherit; }
    button {
      border:1px solid var(--border);
      background:#fff;
      padding:8px 10px;
      border-radius:10px;
      cursor:pointer;
    }
    button.warn { background:#fff7ed; border-color:#fed7aa; }
    button.active { outline:2px solid #111827; }

    .row { display:flex; gap:8px; align-items:center; }
    .pill {
      font-size:12px;
      padding:4px 8px;
      border:1px solid var(--border);
      border-radius:999px;
      background:#fff;
      color:var(--muted);
    }

    /* ğŸ”´ğŸ”µâš« íœ ìƒ‰ìƒ ë²„íŠ¼ (ì•„ì´ì½˜ë§Œ) */
    .colorBtn {
      width:34px;
      height:34px;
      padding:0;
      border-radius:999px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
    }
    .colorBtn.active { outline:2px solid #111827; }
    .dot {
      width:14px;
      height:14px;
      border-radius:999px;
      border:1px solid var(--border);
    }
    .dot.black { background:#111827; }
    .dot.red   { background:#ef4444; }
    .dot.blue  { background:#3b82f6; }

    .problem {
      display:flex;
      gap:16px;
      padding:16px;
      border-bottom:1px solid var(--border);
      background:#fafafa;
    }
    .problem img {
      width:700px;
      height:280px;
      object-fit:contain;
      border:1px solid var(--border);
      border-radius:12px;
      background:#fff;
      display:none;
      cursor:zoom-in;
    }
    .problem label {
      font-size:12px;
      color:var(--muted);
      display:block;
      margin-bottom:6px;
    }

    .canvasWrap { flex:1; min-height:0; }
    canvas {
      width:100%;
      height:100%;
      display:block;
      background:#fff;
      touch-action:none;
    }

    .statusbar {
      padding:8px 12px;
      border-top:1px solid var(--border);
      background:var(--bg);
      font-size:12px;
      color:var(--muted);
      display:flex;
      justify-content:space-between;
    }

    /* RIGHT (ì±„íŒ…ë§Œ ìŠ¤í¬ë¡¤) */
    .right {
      display:flex;
      flex-direction:column;
      min-height:0;
    }
    .chat {
      flex:1;
      min-height:0;
      overflow:auto;
      padding:12px;
      background:#fff;
    }
    .msg {
      max-width:90%;
      padding:10px 12px;
      border:1px solid var(--border);
      border-radius:14px;
      margin:8px 0;
      white-space:pre-wrap;
    }
    .msg.user { margin-left:auto; background:#f9fafb; }
    .msg.ai { margin-right:auto; }
    .msg.system { background:#fefce8; border-color:#fde68a; }

    .composer {
      border-top:1px solid var(--border);
      padding:10px;
      display:flex;
      gap:8px;
      background:var(--bg);
    }
    .composer input {
      flex:1;
      padding:10px 12px;
      border:1px solid var(--border);
      border-radius:12px;
    }

    /* ì´ë¯¸ì§€ íŒì—… */
    .modal { position:fixed; inset:0; display:none; z-index:9999; }
    .modal.open { display:block; }
    .modal-backdrop { position:absolute; inset:0; background:rgba(0,0,0,.6); }
    .modal-panel { position:absolute; inset:24px; display:flex; align-items:center; justify-content:center; }
    .modal-img { max-width:95vw; max-height:90vh; background:#fff; border-radius:10px; }
  </style>
</head>

<body>
<header>
  <h1>í›ˆìˆ˜ AI Agent (ì›¹ MVP)</h1>
  <div class="small">ì™¼ìª½ í•„ê¸° Â· ì˜¤ë¥¸ìª½ ì±„íŒ…</div>
  <div class="grow"></div>
  <span class="pill" id="penInfo">pointer:-</span>
  <span class="pill" id="idleInfo">idle:0s</span>
</header>

<div class="wrap">
  <!-- LEFT -->
  <section class="left">
    <div class="toolbar">
      <div class="row">
        <button id="toolPen" class="active">íœ</button>
        <button id="toolEraser">ì§€ìš°ê°œ</button>
        <button id="undoBtn">Undo</button>
        <button id="clearBtn" class="warn">Clear</button>
      </div>

      <div class="row">
        <span class="pill">ìƒ‰</span>
        <button id="colorBlack" class="colorBtn active" title="ê²€ì •"><span class="dot black"></span></button>
        <button id="colorRed"   class="colorBtn" title="ë¹¨ê°•"><span class="dot red"></span></button>
        <button id="colorBlue"  class="colorBtn" title="íŒŒë‘"><span class="dot blue"></span></button>
      </div>

      <div class="row">
        <span class="pill">íœ</span>
        <input id="penWidth" type="range" min="2" max="14" value="4">
        <span class="pill">ì§€ìš°ê°œ</span>
        <input id="eraserWidth" type="range" min="8" max="40" value="18">
      </div>
    </div>

    <div class="problem">
      <img id="problemPreview">
      <div>
        <label>ë¬¸ì œ ì´ë¯¸ì§€ ì—…ë¡œë“œ</label>
        <input id="problemFile" type="file" accept="image/*">
      </div>
    </div>

    <div class="canvasWrap">
      <canvas id="board"></canvas>
    </div>

    <div class="statusbar">
      <div id="statusLeft">ìƒíƒœ: ì¤€ë¹„</div>
      <div>strokes: <span id="strokeCount">0</span></div>
    </div>
  </section>

  <!-- RIGHT -->
  <section class="right">
    <div id="chat" class="chat"></div>
    <div class="composer">
      <input id="chatInput" placeholder="ì—¬ê¸°ì— ì§ˆë¬¸ ì…ë ¥">
      <button id="sendBtn">ì „ì†¡</button>
    </div>
  </section>
</div>

<!-- ì´ë¯¸ì§€ ëª¨ë‹¬ -->
<div class="modal" id="imgModal">
  <div class="modal-backdrop"></div>
  <div class="modal-panel">
    <img id="modalImg" class="modal-img">
  </div>
</div>

<script>
/* ===== ìƒíƒœ ===== */
let tool="pen";
let penColor="#111827";
let strokes=[];
let isDrawing=false;
let currentStroke=null;
let lastInputAt=Date.now();

const canvas=document.getElementById("board");
const ctx=canvas.getContext("2d");
const $=id=>document.getElementById(id);

/* ===== ìº”ë²„ìŠ¤ ===== */
function resizeCanvas(){
  const r=canvas.getBoundingClientRect();
  const dpr=window.devicePixelRatio||1;
  canvas.width=r.width*dpr;
  canvas.height=r.height*dpr;
  ctx.setTransform(dpr,0,0,dpr,0,0);
  redraw();
}
window.addEventListener("resize",resizeCanvas);

function redraw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  strokes.forEach(s=>{
    ctx.save();
    ctx.lineCap="round";
    ctx.lineJoin="round";
    ctx.lineWidth=s.width;
    if(s.tool==="eraser"){
      ctx.globalCompositeOperation="destination-out";
      ctx.strokeStyle="#000";
    }else{
      ctx.globalCompositeOperation="source-over";
      ctx.strokeStyle=s.color;
    }
    ctx.beginPath();
    ctx.moveTo(s.points[0].x,s.points[0].y);
    s.points.forEach(p=>ctx.lineTo(p.x,p.y));
    ctx.stroke();
    ctx.restore();
  });
  $("strokeCount").textContent=strokes.length;
}

function pos(e){
  const r=canvas.getBoundingClientRect();
  return {x:e.clientX-r.left,y:e.clientY-r.top};
}

canvas.addEventListener("pointerdown",e=>{
  isDrawing=true;
  lastInputAt=Date.now();
  const p=pos(e);
  currentStroke={
    tool,
    color:penColor,
    width: tool==="pen"?+$("penWidth").value:+$("eraserWidth").value,
    points:[p]
  };
  strokes.push(currentStroke);
  redraw();
});

canvas.addEventListener("pointermove",e=>{
  if(!isDrawing)return;
  currentStroke.points.push(pos(e));
  redraw();
});

canvas.addEventListener("pointerup",()=>isDrawing=false);

/* ===== íˆ´ ===== */
$("toolPen").onclick=()=>{tool="pen";$("toolPen").classList.add("active");$("toolEraser").classList.remove("active");};
$("toolEraser").onclick=()=>{tool="eraser";$("toolEraser").classList.add("active");$("toolPen").classList.remove("active");};

$("undoBtn").onclick=()=>{strokes.pop();redraw();};
$("clearBtn").onclick=()=>{strokes=[];redraw();};

/* ===== ìƒ‰ìƒ ===== */
function setColor(c){
  penColor=c;
  ["colorBlack","colorRed","colorBlue"].forEach(id=>$(id).classList.remove("active"));
}
$("colorBlack").onclick=()=>{setColor("#111827");$("colorBlack").classList.add("active");};
$("colorRed").onclick=()=>{setColor("#ef4444");$("colorRed").classList.add("active");};
$("colorBlue").onclick=()=>{setColor("#3b82f6");$("colorBlue").classList.add("active");};

/* ===== ì´ë¯¸ì§€ ===== */
$("problemFile").onchange=e=>{
  const f=e.target.files[0];
  if(!f)return;
  const r=new FileReader();
  r.onload=()=>{
    $("problemPreview").src=r.result;
    $("problemPreview").style.display="block";
    resizeCanvas();
  };
  r.readAsDataURL(f);
};

$("problemPreview").onclick=()=>{
  $("modalImg").src=$("problemPreview").src;
  $("imgModal").classList.add("open");
};
$("imgModal").onclick=()=>$("imgModal").classList.remove("open");

/* ===== ì±„íŒ… ===== */
function addMsg(role,t){
  const d=document.createElement("div");
  d.className="msg "+role;
  d.textContent=t;
  $("chat").appendChild(d);
  $("chat").scrollTop=$("chat").scrollHeight;
}
$("sendBtn").onclick=()=>{
  const v=$("chatInput").value.trim();
  if(!v)return;
  $("chatInput").value="";
  addMsg("user",v);
};

resizeCanvas();
</script>
</body>
</html>
